@model BidNest.ViewModels.CategoryViewModel
@{
    ViewData["Title"] = "Delete Category";
    Layout = "~/Views/Shared/_AdminLayout.cshtml";
}

<div class="container-xxl flex-grow-1 container-p-y">
    <h4 class="fw-bold py-3 mb-4">
        <span class="text-muted fw-light">Management / Categories /</span> Delete
    </h4>

    <div class="row justify-content-center">
        <div class="col-md-8">
            <div class="card">
                <div class="card-header">
                    <h5 class="mb-0 text-danger">
                        <i class="bx bx-trash"></i> Delete Category
                    </h5>
                </div>

                <div class="card-body">
                    @if (ViewBag.CanDelete == false)
                    {
                        <div class="alert alert-danger" role="alert">
                            <h6 class="alert-heading">
                                <i class="bx bx-error"></i> Cannot Delete Category
                            </h6>
                            <p class="mb-0">
                                This category cannot be deleted because it contains items or has subcategories. 
                                Please move or delete all items and subcategories first, or use the merge function to combine with another category.
                            </p>
                        </div>
                    }
                    else
                    {
                        <div class="alert alert-warning" role="alert">
                            <h6 class="alert-heading">
                                <i class="bx bx-warning"></i> Confirm Deletion
                            </h6>
                            <p class="mb-0">
                                Are you sure you want to delete this category? This action cannot be undone.
                            </p>
                        </div>
                    }

                    <div class="category-details p-4 bg-light rounded">
                        <div class="row mb-3">
                            <div class="col-sm-4">
                                <strong>Category Name:</strong>
                            </div>
                            <div class="col-sm-8">
                                <div class="d-flex align-items-center">
                                    <i class="bx bx-category me-2"></i>
                                    @Model.Name
                                </div>
                            </div>
                        </div>

                        @if (!string.IsNullOrEmpty(Model.Description))
                        {
                            <div class="row mb-3">
                                <div class="col-sm-4">
                                    <strong>Description:</strong>
                                </div>
                                <div class="col-sm-8">
                                    @Model.Description
                                </div>
                            </div>
                        }

                        <div class="row mb-3">
                            <div class="col-sm-4">
                                <strong>Parent Category:</strong>
                            </div>
                            <div class="col-sm-8">
                                @if (!string.IsNullOrEmpty(Model.ParentName))
                                {
                                    <span class="badge bg-label-info">@Model.ParentName</span>
                                }
                                else
                                {
                                    <span class="text-muted">Root Category</span>
                                }
                            </div>
                        </div>

                        <div class="row mb-3">
                            <div class="col-sm-4">
                                <strong>Items Count:</strong>
                            </div>
                            <div class="col-sm-8">
                                <span class="badge @(Model.ItemCount > 0 ? "bg-label-danger" : "bg-label-success")">
                                    @Model.ItemCount
                                </span>
                            </div>
                        </div>

                        <div class="row mb-3">
                            <div class="col-sm-4">
                                <strong>Sub Categories:</strong>
                            </div>
                            <div class="col-sm-8">
                                <span class="badge @(Model.SubCategoryCount > 0 ? "bg-label-danger" : "bg-label-success")">
                                    @Model.SubCategoryCount
                                </span>
                            </div>
                        </div>

                        <div class="row">
                            <div class="col-sm-4">
                                <strong>Status:</strong>
                            </div>
                            <div class="col-sm-8">
                                @if (Model.IsActive)
                                {
                                    <span class="badge bg-label-success">Active</span>
                                }
                                else
                                {
                                    <span class="badge bg-label-secondary">Inactive</span>
                                }
                            </div>
                        </div>
                    </div>

                    <div class="mt-4">
                        @if (ViewBag.CanDelete == true)
                        {
                            <form asp-action="DeleteCategory" method="post" style="display: inline;">
                                @Html.AntiForgeryToken()
                                <input type="hidden" asp-for="CategoryId">
                                <button type="submit" class="btn btn-danger" onclick="return confirm('Are you absolutely sure you want to delete this category? This action cannot be undone.')">
                                    <i class="bx bx-trash"></i> Yes, Delete Category
                                </button>
                            </form>
                        }
                        else
                        {
                            <a href="@Url.Action("MergeCategories")" class="btn btn-warning">
                                <i class="bx bx-merge"></i> Merge Category Instead
                            </a>
                        }
                        
                        <a href="@Url.Action("Categories")" class="btn btn-outline-secondary ms-2">
                            <i class="bx bx-arrow-back"></i> Cancel
                        </a>
                        
                        <a href="@Url.Action("CategoryDetails", new { id = Model.CategoryId })" class="btn btn-outline-info ms-2">
                            <i class="bx bx-show"></i> View Details
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
